<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Game ‚Äî <%- name %></title>
  <link rel="stylesheet" href="/css/bundle.css" />
</head>

<body class="page-game" data-game-id="<%- id %>">

  <div class="bg"></div>
  <div class="header">
    <h1><%- name %></h1>
    <div class="header__identity">
      <span class="user-info">Playing as: <strong><%- currentUsername %></strong></span>
      <a href="/lobby" class="logout-btn">Return to Lobby</a>
    </div>
  </div>

  <div class="game-layout">
    <div class="game-table-area">
      <div class="table-wrapper">
        <div class="poker-table">
          <div class="pot" id="pot-display">Pot: $<%- pot_money || 0 %></div>

          <div class="community-cards" id="community-cards">
            <!-- Community cards will be rendered dynamically -->
          </div>

          <!-- Real player seats from database -->
          <div id="seats" class="player-seats">
            <% var seatClasses=['seat-pos-1', 'seat-pos-3' , 'seat-pos-5' , 'seat-pos-7' , 'seat-pos-2' , 'seat-pos-4'
              , 'seat-pos-6' , 'seat-pos-8' ]; %>
              <% for (var pi=0; pi < players.length; pi++) { %>
                <% var player=players[pi]; %>
                  <% var playerPos=player.position || (pi + 1); %>
                    <% var posClass=seatClasses[playerPos - 1] || 'seat-pos-' + (pi + 1); %>
                      <% var isMyTurn=player.user_id===current_turn_user_id; %>
                        <div class="player-seat <%- posClass %><% if (isMyTurn) { %> active-turn<% } %>"
                          data-user-id="<%- player.user_id %>">
                          <div class="player-seat__label">
                            <strong><%- player.username %></strong>
                            <div class="player-seat__stack">$<%- player.chip_count %></div>
                            <% if (player.current_bet> 0) { %>
                              <div class="current-bet">Bet: $<%- player.current_bet %></div>
                              <% } %>
                          </div>
                        </div>
                        <% } %>

                          <!-- Empty seats for remaining positions -->
                          <% for (var ei=players.length; ei < maxPlayers; ei++) { %>
                            <% var emptyPosClass=seatClasses[ei] || 'seat-pos-' + (ei + 1); %>
                              <div class="player-seat <%- emptyPosClass %> player-seat--empty">
                                <div class="player-seat__label">Empty</div>
                              </div>
                              <% } %>
          </div>

          <div class="player-controls">
            <div class="turn-timer-container">
              <div id="turn-timer" class="turn-timer">30s</div>
              <div class="turn-timer-bar">
                <div id="turn-timer-fill" class="turn-timer-fill"></div>
              </div>
            </div>
            <div class="player-hand-cards" id="player-hand">
              <!-- Player's hole cards will be rendered dynamically -->
            </div>
            <button class="action-btn btn-fold">Fold</button>
            <button class="action-btn action-btn--call btn-call">Call</button>
            <div class="action-group">
              <button class="action-btn action-btn--raise btn-raise">Raise</button>
              <input class="raise-input" type="number" min="1" value="5" aria-label="raise amount" />
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="game-sidebar">
      <div class="game-meta">
        <div class="meta-title">Game Info</div>
        <div><strong>Name:</strong> <%- name %></div>
        <div><strong>State:</strong> <span id="game-state" class="game-state-badge game-state--<%- state %>"><%- state
              %></span></div>
        <div><strong>Players:</strong> <span id="player-count"><%- players.length %></span> / <%- maxPlayers %></div>

        <% if (currentUserId===created_by && state==='lobby' ) { %>
          <form method="post" action="/games/<%- id %>/start" class="start-game-form">
            <button type="submit" class="btn-start-game">
              üéÆ Start Game
            </button>
            <small class="start-hint">(Need at least 2 players)</small>
          </form>
          <% } %>

            <% if (currentUserId===created_by && state!=='lobby' && state!=='game-over' ) { %>
              <form method="post" action="/games/<%- id %>/end" class="end-game-form">
                <button type="submit" class="btn-end-game">
                  üèÅ End Game
                </button>
              </form>
              <% } %>

                <% if (state==='game-over' ) { %>
                  <div class="game-over-message">
                    <strong>üéâ Game Over!</strong>
                  </div>
                  <% } %>

                    <div class="meta-return"><a href="/lobby">Return to lobby</a></div>
      </div>

      <div class="game-chat">
        <div class="game-chat__title">Chat</div>
        <div id="game-chat-messages" class="messages">
          <!-- Chat messages will be populated dynamically -->
        </div>
        <input id="game-chat-input" placeholder="Say something..." />
      </div>
    </div>
  </div>

  <script src="/js/game.js" type="module"></script>
</body>

</html>